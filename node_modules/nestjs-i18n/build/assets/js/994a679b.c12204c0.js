"use strict";(self.webpackChunknestjs_i18n=self.webpackChunknestjs_i18n||[]).push([[323],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>m});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var p=n.createContext({}),l=function(e){var t=n.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},u=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,p=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=l(r),m=o,g=d["".concat(p,".").concat(m)]||d[m]||c[m]||a;return r?n.createElement(g,s(s({ref:t},u),{},{components:r})):n.createElement(g,s({ref:t},u))}));function m(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,s=new Array(a);s[0]=d;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var l=2;l<a;l++)s[l]=r[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},2524:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>c,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var n=r(7462),o=(r(7294),r(3905));const a={sidebar_position:5},s="GraphQL",i={unversionedId:"guides/graphql",id:"guides/graphql",title:"GraphQL",description:"When using GraphQL nestjs-i18n works out of the box in most cases. With normal requests you can add headers etc. so the resolvers still work like you would expect. But when using GraphQL subscriptions this requires additional steps.",source:"@site/docs/guides/graphql.md",sourceDirName:"guides",slug:"/guides/graphql",permalink:"/guides/graphql",draft:!1,editUrl:"https://github.com/toonvanstrijp/nestjs-i18n/tree/main/docs/guides/graphql.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Plurals",permalink:"/guides/plurals"},next:{title:"gRPC",permalink:"/guides/grpc"}},p={},l=[],u={toc:l};function c(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"graphql"},"GraphQL"),(0,o.kt)("p",null,"When using GraphQL ",(0,o.kt)("inlineCode",{parentName:"p"},"nestjs-i18n")," works out of the box in most cases. With normal requests you can add headers etc. so the resolvers still work like you would expect. But when using GraphQL subscriptions this requires additional steps."),(0,o.kt)("p",null,"To fix this change your ",(0,o.kt)("inlineCode",{parentName:"p"},"GraphQLModule")," configuration."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff",metastring:'title="src/app.module.ts"',title:'"src/app.module.ts"'},"  GraphQLModule.forRoot<ApolloDriverConfig>({\n    driver: ApolloDriver,\n    subscriptions: {\n      'graphql-ws': true,\n    },\n    typePaths: ['*/**/*.graphql'],\n+   context: (ctx) => ctx,\n    path: '/graphql',\n  })\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"It's recommened to use ",(0,o.kt)("inlineCode",{parentName:"p"},"graphql-ws")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"subscriptions-transport-ws")," (",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://github.com/apollographql/subscriptions-transport-ws"},"read more")),"). If you're still using ",(0,o.kt)("inlineCode",{parentName:"p"},"subscriptions-transport-ws")," you should re-configure your ",(0,o.kt)("inlineCode",{parentName:"p"},"GraphQLModule"),"."),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-diff",metastring:'title="src/app.module.ts"',title:'"src/app.module.ts"'},"  GraphQLModule.forRoot<ApolloDriverConfig>({\n    driver: ApolloDriver,\n    subscriptions: {\n+     'subscriptions-transport-ws': {\n+       onConnect: (params) => ({ connectionParams: params }),\n+       path: '/graphql'\n      }\n    },\n    typePaths: ['*/**/*.graphql'],\n+   context: (ctx) => ctx,\n    path: '/graphql',\n  })\n"))),(0,o.kt)("p",null,"After that use the following ",(0,o.kt)("inlineCode",{parentName:"p"},"GraphQLWebsocketResolver")," resolver."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff",metastring:'title="src/app.module.ts"',title:'"src/app.module.ts"'},"  I18nModule.forRoot({\n    fallbackLanguage: 'en',\n    loaderOptions: {\n      path: path.join(__dirname, '/i18n/'),\n      watch: true,\n    },\n    resolvers: [\n+     GraphQLWebsocketResolver,\n      { use: QueryResolver, options: ['lang'] },\n      AcceptLanguageResolver,\n    ],\n  })\n")))}c.isMDXComponent=!0}}]);